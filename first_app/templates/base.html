<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>E-Commerce</title>
    {% include 'base/css.html' %}
  </head>
  <body>
    {% include 'base/navbar.html' with brand_name='eCommerce'%}
    {% block content%}{% endblock %}
    {% include 'base/js.html' %}
    <script>
      $(document).ready(function(){
        var productForm = $(".form-product-ajax")
        productForm.submit(function(event){
          event.preventDefault();
          console.log("From not sending")
          var thisForm = $(this)
          var actionEndpoint = thisForm.attr("action")
          var httpMethod = thisForm.attr("method")
          var formData = thisForm.serialize()

          $.ajax({
            url:actionEndpoint,
            method:httpMethod,
            data:formData,
            success: function(data){
              var submitSpan = thisForm.find(".submit-span")
              if (data.added){
                submitSpan.html("In Cart <button type='submit' class='btn btn-link'>Remove</button>")
              } else{
                submitSpan.html("<button type='submit' class='btn btn-success'>Add to Cart</button>")
              }
              navbarCount = $(".navbar-cart-count")
              navbarCount.text(data.cartItemCount)
              var currentPath = window.location.href
              if (currentPath.indexOf("cart") != -1){
                refreshCart()
              }
            },
            error: function(errorData) {
              console.log("error");
              console.log(errorData);
            }
          })
        })
        function refreshCart(){
          console.log("inside update cart");
          var cartTable = $(".cart-table")
          var cartBody = cartTable.find(".cart-body")
          var refreshCartUrl='/api/cart/';
          var refreshCartMethod = "GET";
          var data = {};
          $.ajax({
            url:refreshCartUrl,
            method:refreshCartMethod,
            data:data,
            success:function(data) {
              console.log("in success");
              console.log(data);
            },
            error:function() {
              console.log("error");
            }
          })
        }
      })
    </script>
  </body>
</html>
